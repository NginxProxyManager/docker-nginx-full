#!/bin/bash -e

BLUE='\E[1;34m'
CYAN='\E[1;36m'
YELLOW='\E[1;33m'
GREEN='\E[1;32m'
RESET='\E[0m'

echo -e "${BLUE}❯ ${CYAN}Building ModSecurity ${YELLOW}${MODSECURITY_VERSION}...${RESET}"

# modsecurity connector
mkdir /tmp/modsecurity-nginx
curl -# -L  "${MODSECURITY_NGINX_URL}" | tar -xz --strip 1 -C /tmp/modsecurity-nginx
# modsecurity
git clone --depth 1 --branch v"${MODSECURITY_VERSION}" "${MODSECURITY_GIT_URL}" /tmp/modsecurity
cd /tmp/modsecurity

./build.sh
git submodule init
git submodule update

./configure \
    --with-lmdb \
    --enable-parser-generation \
    --enable-mutex-on-pm
make
make install
mkdir /tmp/configs
cp /tmp/modsecurity/modsecurity.conf-recommended /tmp/configs/modsecurity.conf
cp /tmp/modsecurity/unicode.mapping /tmp/configs
echo -e "${BLUE}❯ ${GREEN}ModSecurity build completed${RESET}"
